#!/usr/bin/env bash

set -e

if [ -z "$SCRIPT_DIR" ]; then
#  PTXDIST_VERSION="${PTXDIST_VERSION:-2017.11.0}"
  PTXDIST_WORKSPACE="${PTXDIST_WORKSPACE:-../../ptxproj}"

  PTXDIST_PLATFORMCONFIG="${PTXDIST_PLATFORMCONFIG:-$PTXDIST_WORKSPACE/selected_platformconfig}"
  PTXCONF_PLATFORM="$(source $PTXDIST_PLATFORMCONFIG && echo "$PTXCONF_PLATFORM")"
  PTXDIST_PLATFORMDIR="${PTXDIST_PLATFORMDIR:-$PTXDIST_WORKSPACE/platform-$PTXCONF_PLATFORM}"

  PTXCONF_SYSROOT_HOST="$(source $PTXDIST_PLATFORMCONFIG && echo "$PTXCONF_SYSROOT_HOST")"
  SYSROOT_HOST="${SYSROOT_HOST:-$PTXCONF_SYSROOT_HOST}"

  SCRIPT_DIR="$SYSROOT_HOST/lib/ct-build"
fi

renice -n 11 -p $$ > /dev/null 2>&1
exec "$SCRIPT_DIR/bin/ptxdist-make" "$@"
