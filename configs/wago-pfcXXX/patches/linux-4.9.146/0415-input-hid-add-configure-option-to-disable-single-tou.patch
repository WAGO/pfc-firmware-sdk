From 1e4df78c2adf3c1b2258269c59717c7e0a80a8de Mon Sep 17 00:00:00 2001
From: Ralf Gliese <gliese@elrest.de>
Date: Fri, 7 Dec 2018 13:11:12 +0100
Subject: [PATCH] input: hid: add configure option to disable single-touch
 events

Signed-off-by: Ralf Gliese <gliese@elrest.de>
---
 drivers/hid/Kconfig      | 10 ++++++++++
 drivers/input/input-mt.c |  2 ++
 2 files changed, 12 insertions(+)

diff --git a/drivers/hid/Kconfig b/drivers/hid/Kconfig
index 8eed456..d5d47e1 100644
--- a/drivers/hid/Kconfig
+++ b/drivers/hid/Kconfig
@@ -573,6 +573,16 @@ config HID_MULTITOUCH
 	  To compile this driver as a module, choose M here: the
 	  module will be called hid-multitouch.
 
+if HID_MULTITOUCH
+	config HID_MULTITOUCH_DISABLE_SINGLETOUCH_EVENTS
+	bool "Disable singletouch events"
+	depends on USB_HID
+	---help---
+	This option disables single touch events generated by the hid-multitouch driver.
+	If this option is not activated the driver is emitting multitouch- and singletouch-
+	events simultaneously.
+endif # HID_MULTITOUCH
+
 config HID_NTRIG
 	tristate "N-Trig touch screen"
 	depends on USB_HID
diff --git a/drivers/input/input-mt.c b/drivers/input/input-mt.c
index a1bbec9..fe97308 100644
--- a/drivers/input/input-mt.c
+++ b/drivers/input/input-mt.c
@@ -305,7 +305,9 @@ void input_mt_sync_frame(struct input_dev *dev)
 	if ((mt->flags & INPUT_MT_POINTER) && !(mt->flags & INPUT_MT_SEMI_MT))
 		use_count = true;
 
+#ifndef CONFIG_HID_MULTITOUCH_DISABLE_SINGLETOUCH_EVENTS
 	input_mt_report_pointer_emulation(dev, use_count);
+#endif
 
 	mt->frame++;
 }
-- 
2.7.4

